{
    "Parameters": {
        "VpcId": {
            "Description": "VPC of the security group",
            "Type": "String"
        },
        "SubnetId": {
            "Description": "Id of the subnet",
            "Type": "String"
        },
        "AmiId": {
            "Description": "Id of the AMI that will be used to create the EC2 instance",
            "Type": "String"
        },
        "InstanceType": {
            "Description": "Instance type of the EC2 instance",
            "Type": "String"
        },
        "KeyPair": {
            "Description": "Key pair that will be used to create the EC2 instance",
            "Type": "String"
        },
        "ServiceName": {
            "Description": "Name of the service",
            "Type": "String"
        },
        "BranchName": {
            "Description": "Name of the branch",
            "Type": "String"
        },
        "TemplatesBucket": {
            "Description": "Name of the s3 bucket",
            "Type": "String"
        },
        "Script": {
            "Description": "Script that will setuo the environment",
            "Type": "String"
        }
    },
    "AWSTemplateFormatVersion": "2010-09-09",
    "Resources": {
        "ServiceSecurityGroup": {
            "Type": "AWS::CloudFormation::Stack",
            "Properties": {
                "TemplateURL": {
                    "Fn::Join": [
                        "/",
                        [
                            "https:/",
                            "s3.amazonaws.com",
                            {"Ref": "TemplatesBucket"},
                            "create-sandbox-security-group.json"
                        ]
                    ]
                },
                "Parameters": {
                    "VpcId": {
                        "Ref": "VpcId"
                    },
                    "GroupName": {
                        "Ref": "ServiceName"
                    }
                },
                "TimeoutInMinutes": "5"
            }
        },
        "ServiceInstance": {
            "Type": "AWS::CloudFormation::Stack",
            "Properties": {
                "TemplateURL": {
                    "Fn::Join": [
                        "/",
                        [
                            "https:/",
                            "s3.amazonaws.com",
                            {"Ref": "TemplatesBucket"},
                            "create-sandbox-instance.json"
                        ]
                    ]
                },
                "Parameters": {
                    "SubnetId": {
                        "Ref": "SubnetId"
                    },
                    "AmiId": {
                        "Ref": "AmiId"
                    },
                    "InstanceType": {
                        "Ref": "InstanceType"
                    },
                    "KeyPair": {
                        "Ref": "KeyPair"
                    },
                    "ServiceName": {
                        "Ref": "ServiceName"
                    },
                    "Script": {
                        "Ref": "Script"
                    }
                },
                "TimeoutInMinutes": "5"
            },
            "DependsOn": "ServiceSecurityGroup"
        }
    }
}